{
    "contents" : "---\ntitle: \"CourseProject2\"\nauthor: \"doyougnu\"\ndate: \"June 16, 2015\"\noutput: html_document\n---\n\n##Synopsis\nThis report analyzes data from the U.S. National Oceanic and Atmospheric\nAdministration's (NOAA) storm database. The goal of this report is twofold: 1.\nTo determine which weather event, in the given database, is most harmful to \nhuman health. 2. Of the recorded weather events, which events are correlated to \nhave the greatest amount of economic consequences. Economic consequences is used\nvaguely here, as one could analyze the oppurtunity cost of lost lives or crops,\nor one could merely ignore consequences of a lost. Given the \ndataset this author chose to focus on economic damage, in place of economic\nconsequences. It was found that the tornado is the most costly weather event in\nterms of human health. This was a consequence of the simple model that was \nchosen - that of a sum between deaths and injuries. As such, tornadoes produce\na large amount of injuries; by dominating the injury variable in the model the\ntornado becomes the weather event that produces the largest \"human Impact\". The\nmost costly weather event was found the be a flood. The flood weather event \ndominated the model in similar fashion to the tornado, only this time it the\nproperty damage varaible was maximized, instead of injuries. In sum, both \nof these results imply that the dataset should be analyzed in terms of \ngeographic data, because floods and tornadoes are location specific.\n\n##Data Preprocessing\nThe following environment was used to process, and analyze the date:\n\n```{r environment, echo=TRUE}\nSys.info()\nR.Version()\n```\n\nThe data is available [here][1], and comes in bzip2 form. To load this into R\nwe perform the following operations:\n\n```{r dataPreprocessing, echo=TRUE, cache=TRUE}\ndownload.file(\"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\", \"FStormData.csv.bz2\", method = \"curl\")\ndf.raw <- read.csv(bzfile(\"FStormData.csv\"), header = TRUE, sep = \",\")\n```\n\nNow lets have a look at the first few lines to see how R is interpreting \nthe data, and the subset the dataframe:\n\n```{r, quickLook, echo=TRUE}\nstr(df.raw)\ndf <- subset(df.raw, select = c(\"PROPDMGEXP\", \"PROPDMG\", \"CROPDMGEXP\", \"CROPDMG\",\n                            \"BGN_DATE\", \"EVTYPE\", \"FATALITIES\", \"INJURIES\"))\n```\n\nThis analysis is focused on the EVTYPE (Event Type) variable, as such it must be\ncleaned in order to be useful. First of all we cannot have \"THUNDERSTORM\" and \n\"TSTM\" mean the same thing in our analysis. Also, white spaces and special \ncharacters must be removed, and any other \"EVTYPE\" that does not make sense for\nthis analysis:\n\n```{r EVTYPEclean, echo=TRUE, cache=TRUE}\n#remove special characters\nlibrary(dplyr)\ndf$EVTYPE <- gsub(\"[[:punct:]]\", \"\", df$EVTYPE)\ndf$EVTYPE <- tolower(df$EVTYPE)\n\n#remove summaries, monthly/weekly summaries\npatternsToRemove <- c(\"monthly\", \"?\")\ngreplString <- paste(patternsToRemove, collapse = \"|\")\ndf <- df[(grepl(greplString, df$EVTYPE)),]\n\n#remove everything that has summary in it\ndf <- df[(!grepl(\"summary\", df$EVTYPE)),]\n\n#turn TSTM into Thunderstorm\ntstorm <- c(\"thunderstorms\", \"thunderstormw\", \"tstm\", \"thunderstorminds\", \"thunderstorminds\", \"thunderstrom\", \"thundertorm\", \"thundertsorm\", \"thundestorm\", \"thunerstorm\", \"thunderstorminds\")\ntstormGsub <- paste(tstorm, collapse = \"|\")\ndf$EVTYPE <- gsub(tstormGsub, \"thunderstorm\", df$EVTYPE)\ndf$EVTYPE <- factor(df$EVTYPE)\n```\n\nNow clean the economic data by converting the PROPDMGEXP and CROPDMGEXP variables\nto scientific notation, concatenating with PROPDMG/CROPDMG, and generating the\nfinal DMG variables\n\n```{r econDataClean, echo=TRUE, message=FALSE, cache=TRUE, warning=FALSE}\nfixDMG <- function(x){\n#function takes a list, loops through the list converting values to scientific\n#notation, converts list class to character to anticipate future paste call\n    x <- toupper(x)\n    x <- gsub(\"[[:punct:]]\", \"\", x)\n    x <- lapply(toupper(x), function(x) \n        ifelse(x == \"K\", \"000\", \n               ifelse(x ==\"M\", \"000000\", \n                      ifelse(x == \"B\", \"000000000\", x))))\n    \n    x <- as.character(unlist(x))\n    x\n}\ndf$CROPDMGEXP <- fixDMG(df$CROPDMGEXP)\ndf$PROPDMGEXP <- fixDMG(df$PROPDMGEXP)\n\n#convert and concatenate damage variables\ndf$PROPDMG <- as.character(df$PROPDMG)\ndf$CROPDMG <- as.character(df$CROPDMG)\ndf$propertyDamage <- as.numeric(paste(df$PROPDMG, df$PROPDMGEXP, sep = \"\"))\ndf$cropDamage <- as.numeric(paste(df$CROPDMG, df$CROPDMGEXP, sep = \"\"))\n```\n\n##Model Definition\nTo asses the impact of Climate Events to human health and the Economy I will be\nusing a simple sum model. Thus INJURIES and FATALITIES will be summed across the\nall time periods in the data frame. The same type of model will be used to \nanalyze the economic damage as well. I prefer to use the [dplyr][2] package for\noperations like this:\n\n```{r modelDef, echo = TRUE, message=FALSE}\n#aggregate for human impact analysis\nlibrary(dplyr)\n\npopulationHealth <- df %>%\n                       group_by(EVTYPE) %>%\n                            summarise(humanInjuries = \n                                        sum(INJURIES, na.rm = TRUE),\n                                      humanDeaths = \n                                        sum(FATALITIES, na.rm = TRUE), \n                                      total =\n                                        sum(INJURIES,\n                                            FATALITIES, na.rm = TRUE)) %>%\n                                arrange(desc(total))\n\n#aggregate for economic impact\neconHealth <- df %>%\n                group_by(EVTYPE) %>%\n                    summarise(propertyImpact = \n                                  sum(propertyDamage, na.rm = TRUE),\n                              cropImpact =\n                                  sum(cropDamage, na.rm = TRUE),\n                              total = \n                                sum(cropDamage,\n                                    propertyDamage, na.rm = TRUE)) %>%\n                        arrange(desc(total))\n```\n\n\n##Results\nHere is the top ten damaging events by Economic damage and impact to human health\nsorted by total economic and human impact:\n\n```{r topTens, echo = TRUE}\npopulationHealth[1:15,]\neconHealth[1:15,]\n```\n\nI would expect earthquakes to be at the top of the list because given the model\nthe event type which maximizes injuries and deaths will also maximize the \n\"total impact\". Likewise for the economic damage, however earthquakes are not\ndefined as a \"weather event\" in this dataset.\n\nHere are some plots to describe the most costly weather events in terms of \neconomic and human impact:\n\n```{r plots, echo=TRUE, message=FALSE, warning=FALSE}\n#load ggplot2\nlibrary(ggplot2)\n\n#subset data for plots\npopulationHealth.sub <- populationHealth[1:15, 1:3]\neconHealth.sub <- econHealth[1:15, 1:3]\n\n#melt data to long tidy form\nlibrary(tidyr)\npopulationHealth.sub.tidy <- populationHealth.sub %>%\n    gather(impactType, impact, 2:3) %>%\n        arrange(impactType, desc(impact))\n\neconHealth.sub.tidy <- econHealth.sub %>%\n        gather(impactType, impact, 2:3) %>%\n            arrange(impactType, desc(impact))\n\n#plots\nggplot(populationHealth.sub.tidy, aes(x = factor(EVTYPE, levels = EVTYPE), \n                                      y = impact,\n                                      fill = impactType)) + \n    geom_bar(stat = \"identity\") +\n    coord_flip() +\n    ggtitle(\"Impact of Weather Events on Human Health\") +\n    labs(y = \"Human Impact by Fatalities and Injuries\", x = \"Event Type\")\n\nggplot(econHealth.sub.tidy, aes(x = factor(EVTYPE, levels = EVTYPE),\n                                y = impact/100000000,\n                                fill = impactType)) +\n    geom_bar(stat = \"identity\") +\n    coord_flip() +\n    ggtitle(\"Economic Impact by Weather Event\") +\n    labs(y = \"Economic Impact in Billions of Dollars\", x = \"Event Type\")\n```\n\nTaking the plots in order: The most costly weather event in terms of human\nwellbeing (defined as the sum of injuries and deaths) is the occurance of a\ntornado. Tornado's dominate the dataset by an order of magnitude in injury\ncount. As this model treats an injury equal to a death this assymetry causes\nthe model to conclude the tornado as the most costly weather event to human\nwellbeing. In the future this model could be revised, or merely reduced to a \npeerly economic analysis; while some might find equating a life to a price value\nthe oppurtunity cost of a death is substantial and of economic importance, so \nthat analysis may have some merit.  \n\nTurning to the economic analysis, the most costly weather event is a flood. For\nsimilary reasons to the tornado, the flood dominates the model by maximizing the\nproperty impact variable. The results of flood and tornados dominating the model\nleads me to think that the dataset may be biased towards the southwest. I would\ncertainly expect it to be biased towards population centers - as there is no\nhealth nor economic impact without people. Future analyses may try to analyze\nthis dataset in relation to geographic or socioeconomic data; or for that matter\nreduce to the cropImpact veriable to a property Impact metric, as a crop is a\nform of property.\n\n\n<!---Links--->\n[1]: https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\n[2]: http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html",
    "created" : 1434503310673.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3914990572",
    "id" : "F2692D14",
    "lastKnownWriteTime" : 1434832703,
    "path" : "~/Programming/R_Progs/Reproducible_Research/CourseProject2/CourseProject2.Rmd",
    "project_path" : "CourseProject2.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_markdown"
}